
<!DOCTYPE html>
<html>
<head>
    <title>Goleta Slough Threats Map - Interactive (Leaflet)</title>
    <!-- Tailwind and DaisyUI for sidebar and general styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@latest/dist/full.min.css" rel="stylesheet">
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@latest/dist/leaflet.css" />
    <style>
        body { margin: 0; font-family: Arial, sans-serif; background: #f5f5f5; }
        .main-container { display: flex; width: 100vw; height: 100vh; }
        .sidebar {
            width: 350px; min-width:220px; background: white; padding: 20px 12px 20px 20px; border-right: 3px solid #ccc; overflow-y: auto;
        }
        .map-section { flex: 1 1 0; position: relative; }
        #map { width: 100%; height: 100vh; z-index: 1; }
        /* Custom marker colors */
        .leaflet-marker-icon.critical { filter: hue-rotate(-30deg) brightness(1.02); }
        .leaflet-marker-icon.high { filter: hue-rotate(45deg) brightness(1.05); }
        .leaflet-marker-icon.moderate { filter: hue-rotate(120deg) brightness(1.09);}
        /* Custom popup styling */
        .custom-popup h3 { margin:0 0 4px 0; color:#2c5530; font-size:1.12rem; font-weight:bold;}
        .custom-popup p { margin:2px 0; font-size:0.97rem;}
        .legend-dot { display: inline-block; width: 16px; height: 16px; border-radius: 50%; margin-right: 10px; vertical-align: middle;}
    </style>
</head>
<body>
<div class="main-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <h1>üó∫Ô∏è Goleta Slough Threats</h1>
        <p><strong>Geographic Impact Analysis</strong></p>
        <div class="bg-base-200 p-4 rounded-lg my-5">
            <h3>üìä Overview</h3>
            <p><strong>Areas:</strong> 10</p>
            <p><strong>Projects:</strong> 130</p>
            <p><strong>Threats:</strong> 10 categories</p>
        </div>
        <h3>üéØ Filter by Threat</h3>
        <button class="threat-btn threat-environmental" onclick="filterThreat('Environmental Degradation')">üåø Environmental Degradation (29 projects)</button>
        <button class="threat-btn threat-water" onclick="filterThreat('Coastal/Tidal Flooding')">üåä Coastal/Tidal Flooding (25 projects)</button>
        <button class="threat-btn threat-infrastructure" onclick="filterThreat('Infrastructure Issues')">üèóÔ∏è Infrastructure Issues (18 projects)</button>
        <button class="threat-btn threat-water" onclick="filterThreat('Sea Level Rise')">üìà Sea Level Rise (16 projects)</button>
        <button class="threat-btn threat-water" onclick="filterThreat('Rainfall Flooding')">üåßÔ∏è Rainfall Flooding (14 projects)</button>
        <button class="threat-btn threat-environmental" onclick="filterThreat('Coastal Erosion')">üèñÔ∏è Coastal Erosion (11 projects)</button>
        <button style="background: #6c757d; color: white; padding: 10px; border: none; border-radius: 5px; width: 100%; margin-top: 15px; cursor: pointer;" onclick="clearFilter()">Clear Filters</button>
        <div class="bg-base-200 p-4 rounded-lg mt-5">
            <h3>üìç Legend</h3>
            <div class="my-2"><span class="legend-dot" style="background: #dc2626;"></span>Critical (25+ projects)</div>
            <div class="my-2"><span class="legend-dot" style="background: #f59e0b;"></span>High (10-24 projects)</div>
            <div class="my-2"><span class="legend-dot" style="background: #10b981;"></span>Moderate (2-9 projects)</div>
        </div>
    </div>
    <!-- Map -->
    <div class="map-section"><div id="map"></div></div>
</div>
<!-- Leaflet JS -->
<script src="https://cdn.jsdelivr.net/npm/leaflet@latest/dist/leaflet.js"></script>
<script>
    // Custom marker icons based on threat level
    function getCustomIcon(level, label) {
        // Color mapping
        let bg = (level === "critical") ? "#dc2626" : (level === "high") ? "#f59e0b" : "#10b981";
        let size = (level === "critical") ? 46 : (level === "high") ? 38 : 28;
        return L.divIcon({
            className: level,
            iconSize: [size, size],
            html: `<div style="
                display:flex;align-items:center;justify-content:center;
                background:${bg};color:#fff;font-weight:bold;
                border-radius:50%;border:3px solid #fff;
                box-shadow:0 2px 10px rgba(0,0,0,.3);
                width:${size}px;height:${size}px;
                font-size:1.1em;
            ">${label}</div>`
        });
    }
    // Marker data: lat, lng, name, projects, threat, level
    const markerData = [
        {lat:34.4202, lng:-119.8513, name:"Goleta Slough Ecological Reserve", projects:29, threat:"Environmental Degradation", level:"critical"},
        {lat:34.41785, lng:-119.8683, name:"Goleta Slough Mouth", projects:25, threat:"Coastal/Tidal Flooding", level:"critical"},
        {lat:34.41995, lng:-119.8573, name:"Old Town Goleta", projects:18, threat:"Infrastructure Issues", level:"high"},
        {lat:34.4261, lng:-119.8442, name:"Santa Barbara Airport", projects:16, threat:"Sea Level Rise", level:"high"},
        {lat:34.43075, lng:-119.8552, name:"San Pedro Creek Area", projects:14, threat:"Rainfall Flooding", level:"high"},
        {lat:34.41844, lng:-119.8650, name:"Goleta Beach Park", projects:11, threat:"Coastal Erosion", level:"high"},
        {lat:34.4105, lng:-119.8710, name:"UCSB Coastal Bluffs", projects:11, threat:"Coastal Erosion", level:"high"},
        {lat:34.4272, lng:-119.8485, name:"Atascadero Creek", projects:9, threat:"Sediment Management", level:"moderate"},
        {lat:34.4349, lng:-119.8412, name:"Watershed Area", projects:4, threat:"Regulatory Issues", level:"moderate"},
        {lat:34.4355, lng:-119.8234, name:"San Jose Creek", projects:2, threat:"Water Management", level:"moderate"},
    ];

    // Map initialization
    const map = L.map('map').setView([34.42, -119.85], 13);
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '<a href="https://osm.org/copyright" target="_blank">OpenStreetMap</a>'
    }).addTo(map);

    // Add markers
    let allMarkers = [];
    markerData.forEach(function(d) {
        let marker = L.marker([d.lat, d.lng], {
            icon: getCustomIcon(d.level, d.projects)
        });
        marker.bindPopup(`<div class="custom-popup">
            <h3>${d.name}</h3>
            <p><strong>Projects:</strong> ${d.projects}</p>
            <p><strong>Primary Threat:</strong> ${d.threat}</p>
            <p style="font-size:12px;color:#888;">Click elsewhere to close</p>
        </div>`);
        marker.threatCat = d.threat; // Save for filtering
        marker.addTo(map);
        allMarkers.push(marker);
    });

    // Filtering logic
    function filterThreat(threat) {
        allMarkers.forEach(m => {
            if (m.threatCat !== threat) {
                map.removeLayer(m);
            } else {
                m.addTo(map);
            }
        });
    }
    function clearFilter() {
        allMarkers.forEach(m => m.addTo(map));
    }

    // Optional: Close popup when clicking elsewhere on map
    map.on('click', function() {
        map.closePopup();
    });

    // Expose filter functions to sidebar buttons
    window.filterThreat = filterThreat;
    window.clearFilter = clearFilter;

    // Prevent map dragging when cursor over sidebar
    document.querySelector('.sidebar').addEventListener('mouseenter', ()=>map.dragging.disable());
    document.querySelector('.sidebar').addEventListener('mouseleave', ()=>map.dragging.enable());
</script>
</body>
</html>
